<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Projet – Météo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body class="bg-blue-50 min-h-screen p-6">

  <h1 class="text-3xl font-bold text-center mb-6">Recherche Météo</h1>

  <div class="max-w-md mx-auto mb-6 flex gap-2">
    <input id="villeInput" type="text" placeholder="Tape une ville… (Côte d'Ivoire, France)"
      class="flex-1 p-3 arrondi bordure ombre">
    <button id="Recherche" class="px-4 py-2 bg-blue-600 text-white arrondi hover:bg-blue-700 transition">
      Recherche
    </button>
  </div>

  <div id="resultat" class="max-w-md mx-auto"></div>

  <script>
    const champVille = document.getElementById("villeInput");
    const zoneResultat = document.getElementById("resultat");
    const bouton = document.getElementById("Recherche");

    // Recherche uniquement lors du clic sur le bouton
    bouton.addEventListener("click", () => {
      const ville = champVille.value.trim();
      if (ville.length > 0) {
        rechercherMeteo(ville);
      } else {
        zoneResultat.innerHTML = "<p class='text-red-600 text-center font-bold'> saisir d'abord une ville.</p>";
      }
    });

    async function rechercherMeteo(ville) {
      try {
        const reponseGeo = await fetch(
          `https://geocoding-api.open-meteo.com/v1/search?name=${ville}&count=1&language=fr&format=json`
        );

        const donneesGeo = await reponseGeo.json();

        if (!donneesGeo.results || donneesGeo.results.length === 0) {
          throw new Error("Ville introuvable.");
        }

        const lieu = donneesGeo.results[0];
        const { name, country, latitude, longitude } = lieu;

        const reponseMeteo = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=auto`
        );

        const donneesMeteo = await reponseMeteo.json();

        if (!donneesMeteo.current_weather) {
          throw new Error("Impossible d’obtenir la météo.");
        }

        const meteo = donneesMeteo.current_weather;

        afficherMeteo(name, country, meteo);

      } catch (erreur) {
        zoneResultat.innerHTML = `
          <p class="text-red-600 text-center font-bold">${erreur.message}</p>
        `;
      }
    }

    function afficherMeteo(ville, pays, meteo) {
      const descriptions = {
        0: "Ciel clair",
        1: "Principalement clair",
        2: "Partiellement nuageux",
        3: "Couvert",
        45: "Brouillard",
        48: "Brouillard givrant",
        51: "Bruine légère",
        61: "Pluie faible",
        63: "Pluie modérée",
        71: "Chute de neige faible",
        80: "Averses légères",
        95: "Orage",
      };

      const temperature = meteo.temperature;
      const vent = meteo.windspeed;
      const code = meteo.weathercode;

      zoneResultat.innerHTML = `
        <div class="bg-white p-6 arrondi ombre text-center">
          <h2 class="text-2xl font-bold">${ville} (${pays})</h2>
          <p class="text-gray-500 mb-4">${descriptions[code] || "Météo inconnue"}</p>
          <p class="text-4xl font-bold mb-4">${temperature}°C</p>
          <p><strong>Vent :</strong> ${vent} km/h</p>
        </div>
      `;
    }
  </script>

</body>
</html>
