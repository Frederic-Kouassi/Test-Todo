<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Projet – Météo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
  <style>
    
  </style>
</head>

<body class="bg-blue-50 min-h-screen p-6">

  <h1 class="text-3xl font-bold text-center mb-6">Recherche Météo</h1>

  <div class="max-w-md mx-auto mb-6 relative">
    <input id="ville" type="text" placeholder="Tape une ville… (Côte d'Ivoire, France)"
           class="flex-1 p-3 arrondi bordure ombre w-full">
    <ul id="Suggestions" class="absolute bg-white border arrondi w-full mt-1 z-10"></ul>
    <button id="Recherche" class="mt-2 px-4 py-2 bg-blue-600 text-white arrondi hover:bg-blue-700 transition w-full">
      Recherche
    </button>
  </div>

  <div id="Resultat" class="max-w-md mx-auto"></div>

  <script>
    const champVille = document.getElementById("ville");
    const listeSuggestions = document.getElementById("Suggestions");
    const boutonRecherche = document.getElementById("Recherche");
    const zoneResultat = document.getElementById("Resultat");

    // affichage des suggestion pendant la saisie
    champVille.addEventListener("input", async () => {
      const texte = champVille.value.trim();
      if (texte.length < 2) {
        listeSuggestions.innerHTML = "";
        return;
      }

      try {
        const reponse = await fetch(
          `https://geocoding-api.open-meteo.com/v1/search?name=${texte}&count=5&language=fr&format=json`
        );
        const donnees = await reponse.json();

        if (!donnees.results) {
          listeSuggestions.innerHTML = "";
          return;
        }

        listeSuggestions.innerHTML = donnees.results
          .map(ville => `<li class="p-2 suggestion-item">${ville.name}, ${ville.country}</li>`)
          .join("");

        document.querySelectorAll(".suggestion-item").forEach(item => {
          item.addEventListener("click", () => {
            champVille.value = item.textContent;
            listeSuggestions.innerHTML = "";
          });
        });

      } catch (erreur) {
        listeSuggestions.innerHTML = "";
        console.log("Erreur suggestions :", erreur);
      }
    });

    // Recherche uniquement lors du clic sur le bouton
    boutonRecherche.addEventListener("click", () => {
      const ville = champVille.value.trim();
      if (ville.length > 0) {
        rechercherMeteo(ville);
        listeSuggestions.innerHTML = "";
      } else {
        zoneResultat.innerHTML = "<p class='text-red-600 text-center font-bold'>Veuillez saisir une ville.</p>";
      }
    });

    
    async function rechercherMeteo(ville) {
      try {
        const reponseGeo = await fetch(
          `https://geocoding-api.open-meteo.com/v1/search?name=${ville}&count=1&language=fr&format=json`
        );
        const donneesGeo = await reponseGeo.json();

        if (!donneesGeo.results || donneesGeo.results.length === 0) {
          throw new Error("Ville introuvable.");
        }

        const lieu = donneesGeo.results[0];
        const { name, country, latitude, longitude } = lieu;

        const reponseMeteo = await fetch(
          `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=auto`
        );
        const donneesMeteo = await reponseMeteo.json();

        if (!donneesMeteo.current_weather) {
          throw new Error("Impossible d’obtenir la météo.");
        }

        afficherMeteo(name, country, donneesMeteo.current_weather);

      } catch (erreur) {
        zoneResultat.innerHTML = `<p class="text-red-600 text-center font-bold">${erreur.message}</p>`;
      }
    }

    
    function afficherMeteo(ville, pays, meteo) {
      const descriptions = {
        0: "Ciel clair",
        1: "Principalement clair",
        2: "Partiellement nuageux",
        3: "Couvert",
        45: "Brouillard",
        48: "Brouillard givrant",
        51: "Bruine légère",
        61: "Pluie faible",
        63: "Pluie modérée",
        71: "Chute de neige faible",
        80: "Averses légères",
        95: "Orage",
      };

      const temperature = meteo.temperature;
      const vent = meteo.windspeed;
      const code = meteo.weathercode;

      zoneResultat.innerHTML = `
        <div class="bg-white p-6 arrondi ombre text-center">
          <h2 class="text-2xl font-bold">${ville} (${pays})</h2>
          <p class="text-gray-500 mb-4">${descriptions[code] || "Météo inconnue"}</p>
          <p class="text-4xl font-bold mb-4">${temperature}°C</p>
          <p><strong>Vent :</strong> ${vent} km/h</p>
        </div>
      `;
    }
  </script>

</body>
</html>
